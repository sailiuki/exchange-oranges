<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»·å€¼è§‚çº æ­£å™¨</title>
    
    <!-- Favicon å®Œæ•´æ”¯æŒ -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="icon" type="image/x-icon" href="favicon/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon/favicon.ico">
    <meta name="theme-color" content="#667eea">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ä»·å€¼è§‚çº æ­£å™¨">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XEZ049M5R2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XEZ049M5R2');
    </script>
    
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .container {
            padding: 50px 50px 30px 50px;
            text-align: center;
            transform: scale(1.3);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .field {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        select {
            padding: 15px 45px 15px 20px;
            font-size: 16px;
            border: 2px solid #e1e8ff;
            border-radius: 12px;
            background: linear-gradient(145deg, #ffffff, #f0f4ff);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 140px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-size: 16px 16px;
            background-position: calc(100% - 15px) center;
            background-repeat: no-repeat;
        }
        
        select:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        select option {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            font-size: 16px;
            border: none;
            margin: 2px 0;
        }
        
        select option:hover {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
        }
        
        select option:checked {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        select optgroup {
            font-weight: bold;
            font-size: 14px;
            color: #667eea;
            background: #f0f4ff;
            padding: 8px 12px;
            margin: 4px 0;
        }
        
        input {
            width: 220px;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e1e8ff;
            border-radius: 12px;
            background: linear-gradient(145deg, #ffffff, #f9fbff);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            text-align: right;
            font-weight: 500;
        }
        
        input:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        input::placeholder {
            color: #a0a0a0;
            font-weight: normal;
        }
        
        h1 {
            font-size: 2.8em;
            margin-bottom: 35px;
            margin-top: -5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .author {
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 500;
            display: block;
            opacity: 0.8;
        }
        
        .author svg {
            transition: all 0.3s ease;
            fill: url(#gradient);
        }
        
        .author:hover {
            transform: translateY(-2px);
            opacity: 1;
            filter: drop-shadow(0 4px 10px rgba(102, 126, 234, 0.3));
        }
        
        .author:hover svg {
            fill: url(#gradientHover);
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 35px;
            margin-bottom: 0px;
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 30px 20px 20px 20px;
                transform: scale(1);
                margin: 10px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 2.2em;
                margin-bottom: 15px;
                margin-top: 5px;
            }
            
            .author {
                font-size: 0.7em;
            }
            
            .social-links {
                margin-top: 30px;
                margin-bottom: 0px;
                gap: 15px;
            }
            
            .field {
                margin: 15px 0;
                flex-direction: row;
                align-items: center;
                gap: 12px;
            }
            
            select {
                min-width: 130px;
                width: 40%;
                padding: 10px 35px 10px 12px;
                font-size: 13px;
                margin-bottom: 0;
            }
            
            input {
                width: 55%;
                padding: 10px 12px;
                font-size: 16px;
                text-align: right;
            }
        }
        
        @media screen and (max-width: 480px) {
            .container {
                padding: 20px 15px 20px 15px;
                margin: 5px;
            }
            
            h1 {
                font-size: 1.8em;
                margin-bottom: 12px;
            }
            
            .author {
                font-size: 0.6em;
            }
            
            .social-links {
                margin-top: 20px;
                margin-bottom: 0px;
                gap: 12px;
            }
            
            .field {
                margin: 10px 0;
                gap: 8px;
            }
            
            select {
                min-width: 110px;
                width: 50%;
                padding: 8px 30px 8px 10px;
                font-size: 12px;
            }
            
            input {
                width: 46%;
                padding: 8px 10px;
                font-size: 16px;
                text-align: right;
            }
        }
        
        /* è‡ªå®šä¹‰ä»£å¸å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(145deg, #ffffff, #f8faff);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 0 0;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .search-container {
            margin-bottom: 25px;
        }
        
        .search-container input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e1e8ff;
            border-radius: 12px;
            background: linear-gradient(145deg, #ffffff, #f0f4ff);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        .search-container input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-results {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .token-result {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(145deg, #ffffff, #f8faff);
            border: 2px solid #e1e8ff;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .token-result:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        .token-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }
        
        .token-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .token-name-row {
            margin-bottom: 8px;
        }
        
        .token-name {
            font-weight: 600;
            color: #333;
        }
        
        .token-bottom-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .token-symbol {
            color: #667eea;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .token-price {
            color: #27ae60;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #667eea;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e1e8ff;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        /* æ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’®æ ·å¼ */
        .add-to-home-btn {
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 500;
            display: block;
            opacity: 0.8;
            font-size: 24px;
            padding: 0;
            line-height: 1;
        }
        
        .add-to-home-btn svg {
            transition: all 0.3s ease;
            fill: url(#gradient);
        }
        
        .add-to-home-btn:hover {
            transform: translateY(-2px);
            opacity: 1;
            filter: drop-shadow(0 4px 10px rgba(102, 126, 234, 0.3));
        }
        
        .add-to-home-btn:hover svg {
            fill: url(#gradientHover);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä»·å€¼è§‚çº æ­£å™¨</h1>
        
        <div class="field">
        <select id="currency1">
            <optgroup label="åŠ å¯†è´§å¸">
                <option value="BTC" selected>ğŸŸ  BTC</option>
                <option value="ETH">â™¦ï¸ ETH</option>
                <option value="SOL">ğŸŸ£ SOL</option>
                <option value="BNB">ğŸŸ¡ BNB</option>
                <option value="OKB">âš« OKB</option>
                <option value="CUSTOM">ğŸ” è‡ªå®šä¹‰ä»£å¸</option>
                <option value="TEMP_CUSTOM_PLACEHOLDER" style="display: none;"></option>
            </optgroup>
            <optgroup label="æ³•å¸">
                <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                <option value="CNY">ğŸ‡¨ğŸ‡³ CNY</option>
                <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                <option value="KRW">ğŸ‡°ğŸ‡· KRW</option>
                <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                <option value="AED">ğŸ‡¦ğŸ‡ª AED</option>
                <option value="HKD">ğŸ‡­ğŸ‡° HKD</option>
                <option value="MYR">ğŸ‡²ğŸ‡¾ MYR</option>
            </optgroup>
            <optgroup label="å®ç‰©">
                <option value="ZHUJIAO">ğŸš çŒªè„šé¥­</option>
                <option value="KFC">ğŸ— KFC</option>
                <option value="IN11">ğŸ’ƒ in11å«©æ¨¡</option>
                <option value="IPHONE17">ğŸ“± iPhone17</option>
                <option value="MACBOOK">ğŸ’» MacBook Air</option>
                <option value="ROLEX">âŒš Rolex</option>
                <option value="XIAOMISU7">ğŸï¸ Xiaomi Su7</option>
                <option value="PORSCHE">ğŸï¸ Porsche 718</option>
                <option value="FERRARI">ğŸï¸ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount1" placeholder="è¾“å…¥é‡‘é¢">
    </div>
    
    <div class="field">
        <select id="currency2">
            <optgroup label="åŠ å¯†è´§å¸">
                <option value="BTC">ğŸŸ  BTC</option>
                <option value="ETH" selected>â™¦ï¸ ETH</option>
                <option value="SOL">ğŸŸ£ SOL</option>
                <option value="BNB">ğŸŸ¡ BNB</option>
                <option value="OKB">âš« OKB</option>
                <option value="CUSTOM">ğŸ” è‡ªå®šä¹‰ä»£å¸</option>
                <option value="TEMP_CUSTOM_PLACEHOLDER" style="display: none;"></option>
            </optgroup>
            <optgroup label="æ³•å¸">
                <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                <option value="CNY">ğŸ‡¨ğŸ‡³ CNY</option>
                <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                <option value="KRW">ğŸ‡°ğŸ‡· KRW</option>
                <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                <option value="AED">ğŸ‡¦ğŸ‡ª AED</option>
                <option value="HKD">ğŸ‡­ğŸ‡° HKD</option>
                <option value="MYR">ğŸ‡²ğŸ‡¾ MYR</option>
            </optgroup>
            <optgroup label="å®ç‰©">
                <option value="ZHUJIAO">ğŸš çŒªè„šé¥­</option>
                <option value="KFC">ğŸ— KFC</option>
                <option value="IN11">ğŸ’ƒ in11å«©æ¨¡</option>
                <option value="IPHONE17">ğŸ“± iPhone17</option>
                <option value="MACBOOK">ğŸ’» MacBook Air</option>
                <option value="ROLEX">âŒš Rolex</option>
                <option value="XIAOMISU7">ğŸï¸ Xiaomi Su7</option>
                <option value="PORSCHE">ğŸï¸ Porsche 718</option>
                <option value="FERRARI">ğŸï¸ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount2" placeholder="è¾“å…¥é‡‘é¢">
    </div>
    
    <div class="field">
        <select id="currency3">
            <optgroup label="åŠ å¯†è´§å¸">
                <option value="BTC">ğŸŸ  BTC</option>
                <option value="ETH">â™¦ï¸ ETH</option>
                <option value="SOL" selected>ğŸŸ£ SOL</option>
                <option value="BNB">ğŸŸ¡ BNB</option>
                <option value="OKB">âš« OKB</option>
                <option value="CUSTOM">ğŸ” è‡ªå®šä¹‰ä»£å¸</option>
                <option value="TEMP_CUSTOM_PLACEHOLDER" style="display: none;"></option>
            </optgroup>
            <optgroup label="æ³•å¸">
                <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                <option value="CNY">ğŸ‡¨ğŸ‡³ CNY</option>
                <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                <option value="KRW">ğŸ‡°ğŸ‡· KRW</option>
                <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                <option value="AED">ğŸ‡¦ğŸ‡ª AED</option>
                <option value="HKD">ğŸ‡­ğŸ‡° HKD</option>
                <option value="MYR">ğŸ‡²ğŸ‡¾ MYR</option>
            </optgroup>
            <optgroup label="å®ç‰©">
                <option value="ZHUJIAO">ğŸš çŒªè„šé¥­</option>
                <option value="KFC">ğŸ— KFC</option>
                <option value="IN11">ğŸ’ƒ in11å«©æ¨¡</option>
                <option value="IPHONE17">ğŸ“± iPhone17</option>
                <option value="MACBOOK">ğŸ’» MacBook Air</option>
                <option value="ROLEX">âŒš Rolex</option>
                <option value="XIAOMISU7">ğŸï¸ Xiaomi Su7</option>
                <option value="PORSCHE">ğŸï¸ Porsche 718</option>
                <option value="FERRARI">ğŸï¸ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount3" placeholder="è¾“å…¥é‡‘é¢">
    </div>
    
    <div class="field">
        <select id="currency4">
            <optgroup label="åŠ å¯†è´§å¸">
                <option value="BTC">ğŸŸ  BTC</option>
                <option value="ETH">â™¦ï¸ ETH</option>
                <option value="SOL">ğŸŸ£ SOL</option>
                <option value="BNB">ğŸŸ¡ BNB</option>
                <option value="OKB">âš« OKB</option>
                <option value="CUSTOM">ğŸ” è‡ªå®šä¹‰ä»£å¸</option>
                <option value="TEMP_CUSTOM_PLACEHOLDER" style="display: none;"></option>
            </optgroup>
            <optgroup label="æ³•å¸">
                <option value="USD" selected>ğŸ‡ºğŸ‡¸ USD</option>
                <option value="CNY">ğŸ‡¨ğŸ‡³ CNY</option>
                <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                <option value="KRW">ğŸ‡°ğŸ‡· KRW</option>
                <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                <option value="AED">ğŸ‡¦ğŸ‡ª AED</option>
                <option value="HKD">ğŸ‡­ğŸ‡° HKD</option>
                <option value="MYR">ğŸ‡²ğŸ‡¾ MYR</option>
            </optgroup>
            <optgroup label="å®ç‰©">
                <option value="ZHUJIAO">ğŸš çŒªè„šé¥­</option>
                <option value="KFC">ğŸ— KFC</option>
                <option value="IN11">ğŸ’ƒ in11å«©æ¨¡</option>
                <option value="IPHONE17">ğŸ“± iPhone17</option>
                <option value="MACBOOK">ğŸ’» MacBook Air</option>
                <option value="ROLEX">âŒš Rolex</option>
                <option value="XIAOMISU7">ğŸï¸ Xiaomi Su7</option>
                <option value="PORSCHE">ğŸï¸ Porsche 718</option>
                <option value="FERRARI">ğŸï¸ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount4" placeholder="è¾“å…¥é‡‘é¢">
    </div>
    
    <div class="field">
        <select id="currency5">
            <optgroup label="åŠ å¯†è´§å¸">
                <option value="BTC">ğŸŸ  BTC</option>
                <option value="ETH">â™¦ï¸ ETH</option>
                <option value="SOL">ğŸŸ£ SOL</option>
                <option value="BNB">ğŸŸ¡ BNB</option>
                <option value="OKB">âš« OKB</option>
                <option value="CUSTOM">ğŸ” è‡ªå®šä¹‰ä»£å¸</option>
                <option value="TEMP_CUSTOM_PLACEHOLDER" style="display: none;"></option>
            </optgroup>
            <optgroup label="æ³•å¸">
                <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                <option value="CNY" selected>ğŸ‡¨ğŸ‡³ CNY</option>
                <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                <option value="KRW">ğŸ‡°ğŸ‡· KRW</option>
                <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                <option value="AED">ğŸ‡¦ğŸ‡ª AED</option>
                <option value="HKD">ğŸ‡­ğŸ‡° HKD</option>
                <option value="MYR">ğŸ‡²ğŸ‡¾ MYR</option>
            </optgroup>
            <optgroup label="å®ç‰©">
                <option value="ZHUJIAO">ğŸš çŒªè„šé¥­</option>
                <option value="KFC">ğŸ— KFC</option>
                <option value="IN11">ğŸ’ƒ in11å«©æ¨¡</option>
                <option value="IPHONE17">ğŸ“± iPhone17</option>
                <option value="MACBOOK">ğŸ’» MacBook Air</option>
                <option value="ROLEX">âŒš Rolex</option>
                <option value="XIAOMISU7">ğŸï¸ Xiaomi Su7</option>
                <option value="PORSCHE">ğŸï¸ Porsche 718</option>
                <option value="FERRARI">ğŸï¸ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount5" placeholder="è¾“å…¥é‡‘é¢">
    </div>
    
    <div class="field">
        <select id="currency6">
            <optgroup label="åŠ å¯†è´§å¸">
                <option value="BTC">ğŸŸ  BTC</option>
                <option value="ETH">â™¦ï¸ ETH</option>
                <option value="SOL">ğŸŸ£ SOL</option>
                <option value="BNB">ğŸŸ¡ BNB</option>
                <option value="OKB">âš« OKB</option>
                <option value="CUSTOM">ğŸ” è‡ªå®šä¹‰ä»£å¸</option>
                <option value="TEMP_CUSTOM_PLACEHOLDER" style="display: none;"></option>
            </optgroup>
            <optgroup label="æ³•å¸">
                <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                <option value="CNY">ğŸ‡¨ğŸ‡³ CNY</option>
                <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                <option value="KRW">ğŸ‡°ğŸ‡· KRW</option>
                <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                <option value="AED">ğŸ‡¦ğŸ‡ª AED</option>
                <option value="HKD" selected>ğŸ‡­ğŸ‡° HKD</option>
                <option value="MYR">ğŸ‡²ğŸ‡¾ MYR</option>
            </optgroup>
            <optgroup label="å®ç‰©">
                <option value="ZHUJIAO">ğŸš çŒªè„šé¥­</option>
                <option value="KFC">ğŸ— KFC</option>
                <option value="IN11">ğŸ’ƒ in11å«©æ¨¡</option>
                <option value="IPHONE17">ğŸ“± iPhone17</option>
                <option value="MACBOOK">ğŸ’» MacBook Air</option>
                <option value="ROLEX">âŒš Rolex</option>
                <option value="XIAOMISU7">ğŸï¸ Xiaomi Su7</option>
                <option value="PORSCHE">ğŸï¸ Porsche 718</option>
                <option value="FERRARI">ğŸï¸ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount6" placeholder="è¾“å…¥é‡‘é¢">
    </div>
    
    <div class="social-links" style="display: flex; justify-content: space-between; align-items: center;">
        <!-- APIçŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div id="apiStatus" class="api-status" style="font-size: 11px; color: #6c757d;">
            æ­£åœ¨åˆå§‹åŒ–æ±‡ç‡æœåŠ¡...
        </div>
        
        <!-- æŒ‰é’®ç»„ -->
        <div style="display: flex; gap: 10px; align-items: center;">
            <svg width="0" height="0" style="position: absolute;">
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#667eea"/>
                        <stop offset="100%" stop-color="#764ba2"/>
                    </linearGradient>
                    <linearGradient id="gradientHover" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#764ba2"/>
                        <stop offset="100%" stop-color="#667eea"/>
                    </linearGradient>
                </defs>
            </svg>
            
            <a href="https://x.com/Wolfy_XBT" target="_blank" class="author">
                <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <a href="https://github.com/WolfyXBT/ValuesCorrector" target="_blank" class="author">
                <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.30.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
            <!-- æ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’® -->
            <button id="addToHomeBtn" class="author add-to-home-btn" title="æ·»åŠ åˆ°ä¸»å±å¹•">
                <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zM7 4V3h10v1H7zM7 18V6h10v12H7zM7 21v-1h10v1H7z" fill="url(#gradient)"/>
                    <path d="M12 8l-4 4h2.5v3h3v-3H16l-4-4z" fill="url(#gradient)"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        let rates = {};
        let updating = false;
        let lastInputField = 1; // è®°å½•æœ€åä¸€æ¬¡è¾“å…¥æ•°å­—çš„æ ä½
        
        // PWA æ·»åŠ åˆ°ä¸»å±å¹•åŠŸèƒ½
        let deferredPrompt;
        const addToHomeBtn = document.getElementById('addToHomeBtn');
        
        // ç›‘å¬beforeinstallpromptäº‹ä»¶
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWAå®‰è£…æç¤ºäº‹ä»¶è§¦å‘');
            e.preventDefault();
            deferredPrompt = e;
            // æ˜¾ç¤ºæ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’®
            addToHomeBtn.style.display = 'block';
        });
        
        // ç‚¹å‡»æ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’®
        addToHomeBtn.addEventListener('click', async () => {
            const isMobile = isMobileDevice();
            
            if (!isMobile) {
                // æ¡Œé¢ç«¯æç¤º
                showDesktopPrompt();
                return;
            }
            
            if (deferredPrompt) {
                // Android Chrome: ç›´æ¥è§¦å‘å®‰è£…æç¤º
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`PWAå®‰è£…ç»“æœ: ${outcome}`);
                if (outcome === 'accepted') {
                    alert('åº”ç”¨å·²æˆåŠŸæ·»åŠ åˆ°ä¸»å±å¹•ï¼ğŸ‰');
                }
                deferredPrompt = null;
            } else {
                // ç§»åŠ¨ç«¯æ‰‹åŠ¨æŒ‡å¼•
                if (window.navigator.standalone === false) {
                    // iOS Safari: æ˜¾ç¤ºæ›´ç›´è§‚çš„æ·»åŠ æŒ‡å¼•
                    showIOSInstallPrompt();
                } else {
                    // æ˜¾ç¤ºæ‰‹åŠ¨æ·»åŠ æŒ‡å¼•
                    showManualInstallInstructions();
                }
            }
        });
        
        // æ¡Œé¢ç«¯æç¤º
        function showDesktopPrompt() {
            const popup = document.createElement('div');
            popup.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', sans-serif;
                    animation: fadeIn 0.3s ease-out;
                ">
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 20px;
                        text-align: center;
                        max-width: 380px;
                        margin: 20px;
                        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                        animation: slideUp 0.3s ease-out;
                    ">
                        <div style="margin-bottom: 20px;">
                            <svg width="60" height="60" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zM7 4V3h10v1H7zM7 18V6h10v12H7zM7 21v-1h10v1H7z" fill="#667eea"/>
                                <path d="M12 8l-4 4h2.5v3h3v-3H16l-4-4z" fill="#667eea"/>
                            </svg>
                        </div>
                        <h3 style="margin: 0 0 15px 0; color: #667eea; font-size: 24px;">ç§»åŠ¨è®¾å¤‡ä¸“äº«</h3>
                        <p style="color: #666; font-size: 16px; line-height: 1.6; margin: 15px 0;">
                            æ·»åŠ åˆ°ä¸»å±å¹•åŠŸèƒ½éœ€è¦åœ¨æ‰‹æœºä¸Šä½¿ç”¨
                        </p>
                        <p style="color: #999; font-size: 14px; line-height: 1.5; margin: 15px 0;">
                            è¯·ç”¨æ‰‹æœºæµè§ˆå™¨æ‰“å¼€æœ¬ç½‘ç«™ï¼Œ<br>
                            å³å¯å°†ä»·å€¼è§‚çº æ­£å™¨æ·»åŠ åˆ°æ‰‹æœºä¸»å±å¹•
                        </p>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: transform 0.2s;
                            margin-top: 10px;
                        ">çŸ¥é“äº†</button>
                    </div>
                </div>
                <style>
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from { transform: translateY(30px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(popup);
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    popup.remove();
                }
            });
        }

        // iOSä¸“é—¨çš„å®‰è£…æç¤º
        function showIOSInstallPrompt() {
            const popup = document.createElement('div');
            popup.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                    animation: fadeIn 0.3s ease-out;
                ">
                    <div style="
                        background: white;
                        padding: 25px;
                        border-radius: 20px;
                        text-align: center;
                        max-width: 320px;
                        margin: 20px;
                        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                        animation: slideUp 0.3s ease-out;
                    ">
                        <div style="margin-bottom: 15px;">
                            <svg width="50" height="50" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zM7 4V3h10v1H7zM7 18V6h10v12H7zM7 21v-1h10v1H7z" fill="#007AFF"/>
                                <path d="M12 8l-4 4h2.5v3h3v-3H16l-4-4z" fill="#007AFF"/>
                            </svg>
                        </div>
                        <h3 style="margin: 0 0 15px 0; color: #007AFF; font-size: 20px;">æ·»åŠ åˆ°ä¸»å±å¹•</h3>
                        <p style="color: #333; font-size: 14px; line-height: 1.5; margin: 10px 0;">
                            <span style="display: inline-block; width: 20px; height: 20px; background: #007AFF; color: white; border-radius: 50%; text-align: center; line-height: 20px; font-size: 12px; margin-right: 8px;">1</span>
                            ç‚¹å‡»åº•éƒ¨çš„"åˆ†äº«"æŒ‰é’®
                        </p>
                        <p style="color: #333; font-size: 14px; line-height: 1.5; margin: 10px 0;">
                            <span style="display: inline-block; width: 20px; height: 20px; background: #007AFF; color: white; border-radius: 50%; text-align: center; line-height: 20px; font-size: 12px; margin-right: 8px;">2</span>
                            é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"
                        </p>
                        <p style="color: #333; font-size: 14px; line-height: 1.5; margin: 10px 0 20px 0;">
                            <span style="display: inline-block; width: 20px; height: 20px; background: #007AFF; color: white; border-radius: 50%; text-align: center; line-height: 20px; font-size: 12px; margin-right: 8px;">3</span>
                            ç‚¹å‡»"æ·»åŠ "å®Œæˆ
                        </p>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: transform 0.2s;
                        ">çŸ¥é“äº†</button>
                    </div>
                </div>
                <style>
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from { transform: translateY(30px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(popup);
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            popup.addEventListener('click', (e) => {
                if (e.target === popup) {
                    popup.remove();
                }
            });
        }

        // æ‰‹åŠ¨æ·»åŠ æŒ‡å¼•
        function showManualInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let message = '';
            if (isIOS) {
                message = 'åœ¨Safariä¸­ï¼š\n1. ç‚¹å‡»åº•éƒ¨åˆ†äº«æŒ‰é’® ğŸ“¤\n2. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"\n3. ç‚¹å‡»"æ·»åŠ "';
            } else if (isAndroid) {
                message = 'åœ¨Chromeä¸­ï¼š\n1. ç‚¹å‡»å³ä¸Šè§’èœå• â‹®\n2. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"\n3. ç‚¹å‡»"æ·»åŠ "';
            } else {
                message = 'è¯·åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æµè§ˆå™¨çš„"æ·»åŠ åˆ°ä¸»å±å¹•"åŠŸèƒ½';
            }
            
            alert(message);
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£…
        window.addEventListener('appinstalled', () => {
            console.log('PWAå·²å®‰è£…åˆ°ä¸»å±å¹•');
            addToHomeBtn.style.display = 'none';
        });
        
        // æ£€æµ‹ç§»åŠ¨è®¾å¤‡å¹¶æ˜¾ç¤ºæŒ‰é’®
        function isMobileDevice() {
            return window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // åˆå§‹åŒ–æŒ‰é’®æ˜¾ç¤ºï¼ˆæ‰€æœ‰è®¾å¤‡éƒ½æ˜¾ç¤ºï¼‰
        setTimeout(() => {
            if (addToHomeBtn) {
                addToHomeBtn.style.display = 'block';
                console.log('æ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’®å·²æ˜¾ç¤º');
            }
        }, 500);
        
        // APIçŠ¶æ€è·Ÿè¸ª
        let apiStatus = {
            coingecko: true,
            lastCheck: 0,
            rateLimited: false,
            usingBackup: false
        };

        // æ›´æ–°APIçŠ¶æ€æ˜¾ç¤º
        function updateApiStatusDisplay(isRealTime, errorMessage) {
            const statusElement = document.getElementById('apiStatus');
            if (!statusElement) return;
            
            // ç¡®ä¿çŠ¶æ€å…ƒç´ å§‹ç»ˆå¯è§
            statusElement.style.display = 'block';
            
            if (isRealTime) {
                statusElement.innerHTML = 'å®æ—¶æ±‡ç‡å·²åŠ è½½';
                statusElement.style.color = '#28a745';
            } else {
                // ä½¿ç”¨ä¼ å…¥çš„é”™è¯¯æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤æ¶ˆæ¯
                const displayMessage = errorMessage || 'å·²è¶…è¿‡æ±‡ç‡æœåŠ¡ API è®¿é—®é™åˆ¶æ¬¡æ•°ï¼Œè¯·ç¨åå†è¯•';
                statusElement.innerHTML = displayMessage;
                statusElement.style.color = '#dc3545';
            }
        }

        // è·å–çœŸå®æ±‡ç‡
        async function loadRates() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const statusElement = document.getElementById('apiStatus');
            if (statusElement) {
                statusElement.innerHTML = 'æ­£åœ¨åŠ è½½æ±‡ç‡æ•°æ®...';
                statusElement.style.color = '#6c757d';
                statusElement.style.display = 'block';
            }
            
            try {
                // è·å–åŠ å¯†è´§å¸ä»·æ ¼ (USD)
                const cryptoResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,binancecoin,okb&vs_currencies=usd');
                
                if (cryptoResponse.status === 429) {
                    console.warn('CoinGecko API è¾¾åˆ°è°ƒç”¨é™åˆ¶ (429)');
                    apiStatus.rateLimited = true;
                    apiStatus.lastCheck = Date.now();
                    throw new Error('CoinGecko API Rate Limited');
                }
                
                const cryptoData = await cryptoResponse.json();
                apiStatus.coingecko = true;
                apiStatus.rateLimited = false;
                apiStatus.usingBackup = false;
                
                // è·å–æ³•å¸æ±‡ç‡ (USDåŸºå‡†)
                const fiatResponse = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                
                if (fiatResponse.status === 429 || !fiatResponse.ok) {
                    console.warn('ExchangeRate API è¾¾åˆ°è°ƒç”¨é™åˆ¶æˆ–è¯·æ±‚å¤±è´¥');
                    apiStatus.rateLimited = true;
                    apiStatus.lastCheck = Date.now();
                    throw new Error('ExchangeRate API Rate Limited');
                }
                
                const fiatData = await fiatResponse.json();
                
                const btcPrice = cryptoData.bitcoin.usd;
                const ethPrice = cryptoData.ethereum.usd;
                const solPrice = cryptoData.solana.usd;
                const bnbPrice = cryptoData.binancecoin.usd;
                const okbPrice = cryptoData.okb.usd;
                
                const currencies = ['CNY', 'JPY', 'KRW', 'SGD', 'AED', 'HKD', 'MYR'];
                const cryptos = ['BTC', 'ETH', 'SOL', 'BNB', 'OKB'];
                const products = ['ZHUJIAO', 'KFC', 'IN11', 'IPHONE17', 'FERRARI', 'PORSCHE', 'XIAOMISU7', 'ROLEX', 'MACBOOK'];
                const cryptoPrices = { BTC: btcPrice, ETH: ethPrice, SOL: solPrice, BNB: bnbPrice, OKB: okbPrice };
                const productPrices = { 
                    ZHUJIAO: 20 / fiatData.rates.CNY,       // 20 CNY è½¬æ¢ä¸º USD
                    KFC: 50 / fiatData.rates.CNY,           // 50 CNY è½¬æ¢ä¸º USD
                    IN11: 3000 / fiatData.rates.CNY,        // 3000 CNY è½¬æ¢ä¸º USD
                    IPHONE17: 799,                          // 799 USD
                    FERRARI: 1750000 / fiatData.rates.CNY,  // 1,750,000 CNY è½¬æ¢ä¸º USD
                    PORSCHE: 550000 / fiatData.rates.CNY,   // 550,000 CNY è½¬æ¢ä¸º USD
                    XIAOMISU7: 215900 / fiatData.rates.CNY, // 215,900 CNY è½¬æ¢ä¸º USD
                    ROLEX: 56500 / fiatData.rates.CNY,      // 56,500 CNY è½¬æ¢ä¸º USD
                    MACBOOK: 999                            // 999 USD
                };
                
                rates = {};
                
                // æ„å»ºæ±‡ç‡çŸ©é˜µ
                // è·å–è‡ªå®šä¹‰ä»£å¸ç¬¦å·åˆ—è¡¨
                const customTokenSymbols = customTokens ? Array.from(customTokens.keys()) : [];
                const allCurrencies = [...cryptos, ...customTokenSymbols, 'USD', ...currencies, ...products];
                allCurrencies.forEach(from => {
                    rates[from] = {};
                    allCurrencies.forEach(to => {
                        if (from === to) {
                            rates[from][to] = 1;
                        } else if (cryptos.includes(from) && cryptos.includes(to)) {
                            // åŠ å¯†è´§å¸ä¹‹é—´
                            rates[from][to] = cryptoPrices[from] / cryptoPrices[to];
                        } else if (cryptos.includes(from) && to === 'USD') {
                            // åŠ å¯†è´§å¸åˆ°ç¾å…ƒ
                            rates[from][to] = cryptoPrices[from];
                        } else if (from === 'USD' && cryptos.includes(to)) {
                            // ç¾å…ƒåˆ°åŠ å¯†è´§å¸
                            rates[from][to] = 1 / cryptoPrices[to];
                        } else if (cryptos.includes(from) && currencies.includes(to)) {
                            // åŠ å¯†è´§å¸åˆ°å…¶ä»–æ³•å¸
                            rates[from][to] = cryptoPrices[from] * fiatData.rates[to];
                        } else if (currencies.includes(from) && cryptos.includes(to)) {
                            // å…¶ä»–æ³•å¸åˆ°åŠ å¯†è´§å¸
                            rates[from][to] = 1 / (cryptoPrices[to] * fiatData.rates[from]);
                        } else if (customTokens && customTokenSymbols.includes(from) && customTokenSymbols.includes(to)) {
                            // è‡ªå®šä¹‰ä»£å¸ä¹‹é—´
                            const fromPrice = customTokens.get(from).price;
                            const toPrice = customTokens.get(to).price;
                            rates[from][to] = fromPrice / toPrice;
                        } else if (customTokens && customTokenSymbols.includes(from) && to === 'USD') {
                            // è‡ªå®šä¹‰ä»£å¸åˆ°ç¾å…ƒ
                            rates[from][to] = customTokens.get(from).price;
                        } else if (customTokens && from === 'USD' && customTokenSymbols.includes(to)) {
                            // ç¾å…ƒåˆ°è‡ªå®šä¹‰ä»£å¸
                            rates[from][to] = 1 / customTokens.get(to).price;
                        } else if (customTokens && customTokenSymbols.includes(from) && cryptos.includes(to)) {
                            // è‡ªå®šä¹‰ä»£å¸åˆ°é¢„è®¾åŠ å¯†è´§å¸
                            const fromPrice = customTokens.get(from).price;
                            rates[from][to] = fromPrice / cryptoPrices[to];
                        } else if (customTokens && cryptos.includes(from) && customTokenSymbols.includes(to)) {
                            // é¢„è®¾åŠ å¯†è´§å¸åˆ°è‡ªå®šä¹‰ä»£å¸
                            const toPrice = customTokens.get(to).price;
                            rates[from][to] = cryptoPrices[from] / toPrice;
                        } else if (customTokens && customTokenSymbols.includes(from) && currencies.includes(to)) {
                            // è‡ªå®šä¹‰ä»£å¸åˆ°å…¶ä»–æ³•å¸
                            const fromPrice = customTokens.get(from).price;
                            rates[from][to] = fromPrice * fiatData.rates[to];
                        } else if (customTokens && currencies.includes(from) && customTokenSymbols.includes(to)) {
                            // å…¶ä»–æ³•å¸åˆ°è‡ªå®šä¹‰ä»£å¸
                            const toPrice = customTokens.get(to).price;
                            rates[from][to] = 1 / (toPrice * fiatData.rates[from]);
                        } else if (from === 'USD' && currencies.includes(to)) {
                            // ç¾å…ƒåˆ°å…¶ä»–æ³•å¸
                            rates[from][to] = fiatData.rates[to];
                        } else if (currencies.includes(from) && to === 'USD') {
                            // å…¶ä»–æ³•å¸åˆ°ç¾å…ƒ
                            rates[from][to] = 1 / fiatData.rates[from];
                        } else if (currencies.includes(from) && currencies.includes(to)) {
                            // æ³•å¸ä¹‹é—´
                            rates[from][to] = fiatData.rates[to] / fiatData.rates[from];
                        } else if (products.includes(from) && to === 'USD') {
                            // äº§å“åˆ°ç¾å…ƒ (1 iPhone17 = 799 USD)
                            rates[from][to] = productPrices[from];
                        } else if (from === 'USD' && products.includes(to)) {
                            // ç¾å…ƒåˆ°äº§å“ (1 USD = 1/799 iPhone17)
                            rates[from][to] = 1 / productPrices[to];
                        } else if (products.includes(from) && currencies.includes(to)) {
                            // äº§å“åˆ°å…¶ä»–æ³•å¸
                            rates[from][to] = productPrices[from] * fiatData.rates[to];
                        } else if (currencies.includes(from) && products.includes(to)) {
                            // å…¶ä»–æ³•å¸åˆ°äº§å“
                            rates[from][to] = 1 / (productPrices[to] * fiatData.rates[from]);
                        } else if (cryptos.includes(from) && products.includes(to)) {
                            // åŠ å¯†è´§å¸åˆ°äº§å“
                            rates[from][to] = cryptoPrices[from] / productPrices[to];
                        } else if (products.includes(from) && cryptos.includes(to)) {
                            // äº§å“åˆ°åŠ å¯†è´§å¸
                            rates[from][to] = productPrices[from] / cryptoPrices[to];
                        } else if (customTokens && customTokenSymbols.includes(from) && products.includes(to)) {
                            // è‡ªå®šä¹‰ä»£å¸åˆ°äº§å“
                            const fromPrice = customTokens.get(from).price;
                            rates[from][to] = fromPrice / productPrices[to];
                        } else if (customTokens && products.includes(from) && customTokenSymbols.includes(to)) {
                            // äº§å“åˆ°è‡ªå®šä¹‰ä»£å¸
                            const toPrice = customTokens.get(to).price;
                            rates[from][to] = productPrices[from] / toPrice;
                        } else if (products.includes(from) && products.includes(to)) {
                            // äº§å“ä¹‹é—´
                            rates[from][to] = productPrices[from] / productPrices[to];
                        }
                    });
                });
                
                console.log('æ±‡ç‡åŠ è½½æˆåŠŸ:', rates);
                updateApiStatusDisplay(true);
                
                // è®¾ç½®å®šæœŸåˆ·æ–°æ±‡ç‡çŠ¶æ€ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
                if (!window.rateRefreshInterval) {
                    window.rateRefreshInterval = setInterval(async () => {
                        try {
                            await loadRates();
                        } catch (error) {
                            console.log('å®šæœŸåˆ·æ–°å¤±è´¥ï¼Œå°†åœ¨ä¸‹æ¬¡å°è¯•');
                        }
                    }, 5 * 60 * 1000); // 5åˆ†é’Ÿ
                }
            } catch (error) {
                console.error('æ±‡ç‡åŠ è½½å¤±è´¥:', error);
                apiStatus.coingecko = false;
                apiStatus.usingBackup = false;
                
                // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒçš„æç¤ºä¿¡æ¯
                let errorMessage = '';
                if (error.message.includes('CoinGecko API Rate Limited')) {
                    errorMessage = 'å·²è¶…è¿‡ CoinGecko API è®¿é—®é™åˆ¶æ¬¡æ•°ï¼Œè¯·ç¨åå†è¯•';
                } else if (error.message.includes('ExchangeRate API Rate Limited')) {
                    errorMessage = 'ExchangeRate æœåŠ¡ API è®¿é—®é™åˆ¶æ¬¡æ•°ï¼Œè¯·ç¨åå†è¯•';
                } else {
                    errorMessage = 'å·²è¶…è¿‡æ±‡ç‡æœåŠ¡ API è®¿é—®é™åˆ¶æ¬¡æ•°ï¼Œè¯·ç¨åå†è¯•';
                }
                
                console.error(errorMessage);
                updateApiStatusDisplay(false, errorMessage);
                
                // æ¸…ç©ºæ±‡ç‡ï¼Œè¡¨ç¤ºæœåŠ¡ä¸å¯ç”¨
                rates = {};
            }
        }
        
        // å…ˆè®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        setupBasicEventListeners();
        
        // ç„¶åæ¢å¤çŠ¶æ€
        restoreState();
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ±‡ç‡ï¼ŒåŠ è½½å®Œæˆåé‡æ–°è®¡ç®—
        loadRates().then(() => {
            console.log('æ±‡ç‡åŠ è½½å®Œæˆï¼Œå‡†å¤‡è®¾ç½®è½¬æ¢åŠŸèƒ½');
            
            // åˆå§‹åŒ–æ‰€æœ‰selectå…ƒç´ çš„logoæ˜¾ç¤º
            for (let i = 1; i <= 6; i++) {
                const select = document.getElementById(`currency${i}`);
                if (select) {
                    updateSelectDisplay(select);
                }
            }
            
            // APIåŠ è½½å®Œæˆåï¼Œå¦‚æœæœ‰æ•°æ®å°±é‡æ–°è®¡ç®—ä¸€æ¬¡ä»¥è·å¾—æœ€æ–°æ±‡ç‡
            const hasData = Array.from({length: 6}, (_, i) => i + 1).some(i => 
                document.getElementById(`amount${i}`).value.trim() !== ''
            );
            if (hasData) {
                // APIåŠ è½½å®Œæˆåï¼Œä»¥æœ€åè¾“å…¥çš„æ ä½ä¸ºåŸºå‡†é‡æ–°è®¡ç®—
                const lastAmount = document.getElementById(`amount${lastInputField}`).value.trim();
                if (lastAmount !== '') {
                    console.log(`APIåŠ è½½å®Œæˆï¼Œä»¥æ ä½${lastInputField}ä¸ºåŸºå‡†é‡æ–°è®¡ç®—æœ€æ–°æ±‡ç‡`);
                    convert(lastInputField);
                }
            }
        });
        
        // ä¿å­˜çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
        function saveState() {
            const state = {};
            for (let i = 1; i <= 6; i++) {
                state[`amount${i}`] = document.getElementById(`amount${i}`).value;
                state[`currency${i}`] = document.getElementById(`currency${i}`).value;
                
                // ä¿å­˜è‡ªå®šä¹‰ä»£å¸ä¿¡æ¯
                const select = document.getElementById(`currency${i}`);
                const customOption = select ? select.querySelector('option[value="CUSTOM"]') : null;
                if (customOption) {
                    state[`customToken${i}`] = {
                        tokenKey: customOption.getAttribute('data-token-key'),
                        tokenName: customOption.getAttribute('data-token-name'),
                        tokenSymbol: customOption.getAttribute('data-token-symbol'),
                        displayText: customOption.getAttribute('data-display-text'),
                        tokenLogo: customOption.getAttribute('data-token-logo')
                    };
                }
            }
            state.lastInputField = lastInputField; // ä¿å­˜æœ€åè¾“å…¥çš„æ ä½
            state.customTokens = customTokens ? Array.from(customTokens.entries()) : []; // ä¿å­˜è‡ªå®šä¹‰ä»£å¸æ•°æ®
            localStorage.setItem('valueConverterState', JSON.stringify(state));
        }
        
        // ä»æœ¬åœ°å­˜å‚¨æ¢å¤çŠ¶æ€
        function restoreState() {
            const savedState = localStorage.getItem('valueConverterState');
            if (savedState) {
                try {
                    const state = JSON.parse(savedState);
                    
                    // æ¢å¤è‡ªå®šä¹‰ä»£å¸æ•°æ®
                    if (state.customTokens && Array.isArray(state.customTokens)) {
                        customTokens = new Map(state.customTokens);
                    }
                    
                    for (let i = 1; i <= 6; i++) {
                        if (state[`amount${i}`]) {
                            document.getElementById(`amount${i}`).value = state[`amount${i}`];
                        }
                        if (state[`currency${i}`]) {
                            document.getElementById(`currency${i}`).value = state[`currency${i}`];
                        }
                        
                        // æ¢å¤è‡ªå®šä¹‰ä»£å¸é€‰é¡¹çš„å±æ€§
                        if (state[`customToken${i}`]) {
                            const select = document.getElementById(`currency${i}`);
                            const customOption = select ? select.querySelector('option[value="CUSTOM"]') : null;
                            if (customOption) {
                                const tokenInfo = state[`customToken${i}`];
                                customOption.setAttribute('data-token-key', tokenInfo.tokenKey || '');
                                customOption.setAttribute('data-token-name', tokenInfo.tokenName || '');
                                customOption.setAttribute('data-token-symbol', tokenInfo.tokenSymbol || '');
                                customOption.setAttribute('data-display-text', tokenInfo.displayText || '');
                                customOption.setAttribute('data-token-logo', tokenInfo.tokenLogo || '');
                            }
                        }
                    }
                    
                    // æ¢å¤æœ€åè¾“å…¥çš„æ ä½
                    if (state.lastInputField) {
                        lastInputField = state.lastInputField;
                    }
                    
                    // æ¢å¤è‡ªå®šä¹‰ä»£å¸çš„å¤–éƒ¨æ˜¾ç¤º
                    for (let i = 1; i <= 6; i++) {
                        const select = document.getElementById(`currency${i}`);
                        if (select) {
                            updateSelectDisplay(select);
                        }
                    }
                    
                    console.log('çŠ¶æ€å·²æ¢å¤:', state);
                } catch (error) {
                    console.log('æ¢å¤çŠ¶æ€å¤±è´¥:', error);
                }
            }
        }
        
        function convert(sourceIndex) {
            console.log('Convertå‡½æ•°è¢«è°ƒç”¨ï¼ŒsourceIndex:', sourceIndex);
            if (updating) {
                console.log('æ­£åœ¨æ›´æ–°ä¸­ï¼Œè·³è¿‡æœ¬æ¬¡è½¬æ¢');
                return;
            }
            
            // æ£€æŸ¥æ±‡ç‡æœåŠ¡æ˜¯å¦å¯ç”¨
            if (!rates || Object.keys(rates).length === 0) {
                console.error('æ±‡ç‡æœåŠ¡ä¸å¯ç”¨ï¼Œæ— æ³•è¿›è¡Œè½¬æ¢');
                updating = false;
                return;
            }
            
            updating = true;
            
            const sourceAmount = document.getElementById(`amount${sourceIndex}`).value.replace(/,/g, '');
            let sourceCurrency = document.getElementById(`currency${sourceIndex}`).value;
            
            // å¤„ç†è‡ªå®šä¹‰ä»£å¸ï¼šå¦‚æœé€‰æ‹©çš„æ˜¯CUSTOMï¼Œè·å–å®é™…çš„ä»£å¸ç¬¦å·
            if (sourceCurrency === 'CUSTOM') {
                const sourceSelect = document.getElementById(`currency${sourceIndex}`);
                const customOption = sourceSelect.querySelector('option[value="CUSTOM"]');
                const tokenKey = customOption ? customOption.getAttribute('data-token-key') : null;
                if (tokenKey) {
                    sourceCurrency = tokenKey;
                }
            }
            
            console.log('è½¬æ¢å‚æ•° - é‡‘é¢:', sourceAmount, 'è´§å¸:', sourceCurrency);
            console.log('rateså¯¹è±¡å­˜åœ¨:', !!rates, 'åŒ…å«è´§å¸æ•°é‡:', rates ? Object.keys(rates).length : 0);
            
            if (!sourceAmount || sourceAmount === '') {
                for (let i = 1; i <= 6; i++) {
                    if (i !== sourceIndex) {
                        document.getElementById(`amount${i}`).value = '';
                    }
                }
                updating = false;
                return;
            }
            
            const amount = parseFloat(sourceAmount);
            if (isNaN(amount)) {
                updating = false;
                return;
            }
            
            for (let i = 1; i <= 6; i++) {
                if (i !== sourceIndex) {
                    let targetCurrency = document.getElementById(`currency${i}`).value;
                    
                    // å¤„ç†ç›®æ ‡è´§å¸ä¹Ÿæ˜¯è‡ªå®šä¹‰ä»£å¸çš„æƒ…å†µ
                    if (targetCurrency === 'CUSTOM') {
                        const targetSelect = document.getElementById(`currency${i}`);
                        const customOption = targetSelect.querySelector('option[value="CUSTOM"]');
                        const tokenKey = customOption ? customOption.getAttribute('data-token-key') : null;
                        if (tokenKey) {
                            targetCurrency = tokenKey;
                        }
                    }
                    
                    let result;
                    
                    if (sourceCurrency === targetCurrency) {
                        result = amount;
                    } else if (rates[sourceCurrency] && rates[sourceCurrency][targetCurrency]) {
                        result = amount * rates[sourceCurrency][targetCurrency];
                    } else {
                        result = 0;
                    }
                    
                    document.getElementById(`amount${i}`).value = result.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                }
            }
            
            updating = false;
        }
        
        // æ‰€æœ‰è´§å¸çš„logoå’Œæ˜¾ç¤ºæ–‡æœ¬æ˜ å°„
        const currencyLogos = {
            // åŠ å¯†è´§å¸ - ä½¿ç”¨çœŸå®logo
            'BTC': { logo: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png', text: 'BTC', type: 'image' },
            'ETH': { logo: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png', text: 'ETH', type: 'image' },
            'SOL': { logo: 'https://assets.coingecko.com/coins/images/4128/large/solana.png', text: 'SOL', type: 'image' },
            'BNB': { logo: 'https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png', text: 'BNB', type: 'image' },
            'OKB': { logo: 'https://assets.coingecko.com/coins/images/4463/large/WeChat_Image_20220118095654.png', text: 'OKB', type: 'image' },
            // æ³•å¸ - ä½¿ç”¨emoji
            'USD': { logo: 'ğŸ‡ºğŸ‡¸', text: 'USD', type: 'emoji' },
            'CNY': { logo: 'ğŸ‡¨ğŸ‡³', text: 'CNY', type: 'emoji' },
            'HKD': { logo: 'ğŸ‡­ğŸ‡°', text: 'HKD', type: 'emoji' },
            'JPY': { logo: 'ğŸ‡¯ğŸ‡µ', text: 'JPY', type: 'emoji' },
            'KRW': { logo: 'ğŸ‡°ğŸ‡·', text: 'KRW', type: 'emoji' },
            'SGD': { logo: 'ğŸ‡¸ğŸ‡¬', text: 'SGD', type: 'emoji' },
            'AED': { logo: 'ğŸ‡¦ğŸ‡ª', text: 'AED', type: 'emoji' },
            'MYR': { logo: 'ğŸ‡²ğŸ‡¾', text: 'MYR', type: 'emoji' },
            // å®ç‰© - ä½¿ç”¨emoji
            'ZHUJIAO': { logo: 'ğŸš', text: 'çŒªè„šé¥­', type: 'emoji' },
            'KFC': { logo: 'ğŸ—', text: 'KFC', type: 'emoji' },
            'IN11': { logo: 'ğŸ’ƒ', text: 'in11å«©æ¨¡', type: 'emoji' },
            'IPHONE17': { logo: 'ğŸ“±', text: 'iPhone17', type: 'emoji' },
            'MACBOOK': { logo: 'ğŸ’»', text: 'MacBook Air', type: 'emoji' },
            'ROLEX': { logo: 'âŒš', text: 'Rolex', type: 'emoji' },
            'XIAOMISU7': { logo: 'ğŸï¸', text: 'Xiaomi Su7', type: 'emoji' },
            'PORSCHE': { logo: 'ğŸï¸', text: 'Porsche 718', type: 'emoji' },
            'FERRARI': { logo: 'ğŸï¸', text: 'Ferrari Roma', type: 'emoji' }
        };

        // æ›´æ–°ä¸‹æ‹‰èœå•çš„å¤–éƒ¨æ˜¾ç¤º
        function updateSelectDisplay(selectElement) {
            const selectedValue = selectElement.value;
            
            // å¤„ç†è‡ªå®šä¹‰ä»£å¸
            const customOption = selectElement.querySelector('option[value="CUSTOM"]');
            if (selectedValue === 'CUSTOM' && customOption) {
                const displayText = customOption.getAttribute('data-display-text');
                const logoUrl = customOption.getAttribute('data-token-logo');
                
                if (displayText && logoUrl) {
                    createSelectOverlay(selectElement, logoUrl, displayText, 'image');
                } else {
                    restoreOriginalDisplay(selectElement);
                }
            }
            // å¤„ç†æ‰€æœ‰é¢„è®¾è´§å¸
            else if (currencyLogos[selectedValue]) {
                const currencyData = currencyLogos[selectedValue];
                createSelectOverlay(selectElement, currencyData.logo, currencyData.text, currencyData.type);
            } else {
                restoreOriginalDisplay(selectElement);
            }
        }
        
        // åˆ›å»ºé€‰æ‹©æ¡†è¦†ç›–å±‚
        function createSelectOverlay(selectElement, logoUrl, displayText, logoType = 'image') {
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ˜¾ç¤ºå±‚æ¥è¦†ç›–åŸå§‹çš„selectæ˜¾ç¤º
            let displayOverlay = selectElement.nextElementSibling;
            if (!displayOverlay || !displayOverlay.classList.contains('custom-select-display')) {
                displayOverlay = document.createElement('div');
                displayOverlay.className = 'custom-select-display';
                
                // è·å–selectå…ƒç´ çš„ç²¾ç¡®ä½ç½®å’Œæ ·å¼
                const selectStyles = window.getComputedStyle(selectElement);
                const isMediaQuery480 = window.matchMedia('(max-width: 480px)').matches;
                const isMediaQuery768 = window.matchMedia('(max-width: 768px)').matches;
                
                // æ ¹æ®åª’ä½“æŸ¥è¯¢è°ƒæ•´æ ·å¼
                let adjustedRightMargin = '45px'; // é»˜è®¤æ‰£é™¤ä¸‹æ‹‰ç®­å¤´çš„å®½åº¦
                
                if (isMediaQuery480) {
                    adjustedRightMargin = '30px'; // ç§»åŠ¨ç«¯ç®­å¤´æ›´å°
                } else if (isMediaQuery768) {
                    adjustedRightMargin = '35px'; // ä¸­ç­‰å±å¹•
                }
                
                displayOverlay.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: ${adjustedRightMargin};
                    height: 100%;
                    pointer-events: none;
                    z-index: 1;
                    padding: 0;
                    margin: 0;
                    font-size: ${selectStyles.fontSize};
                    font-family: ${selectStyles.fontFamily};
                    line-height: ${selectStyles.lineHeight};
                    color: #333;
                    background: transparent;
                    box-sizing: border-box;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                `;
                selectElement.parentNode.style.position = 'relative';
                selectElement.parentNode.insertBefore(displayOverlay, selectElement.nextSibling);
            }
            
            // æ¸…ç©ºå†…å®¹å¹¶æ·»åŠ Logo + æ–‡æœ¬
            displayOverlay.innerHTML = '';
            
            // åˆ›å»ºå®¹å™¨div
            const contentDiv = document.createElement('div');
            
            // é‡æ–°è·å–å½“å‰çš„åª’ä½“æŸ¥è¯¢çŠ¶æ€å’Œæ ·å¼
            const selectStyles = window.getComputedStyle(selectElement);
            const isMediaQuery480 = window.matchMedia('(max-width: 480px)').matches;
            const isMediaQuery768 = window.matchMedia('(max-width: 768px)').matches;
            
            let paddingLeft = selectStyles.paddingLeft;
            let logoTextGap = '8px';
            let logoSize = '20px';
            let emojiSize = '14px';
            
            if (isMediaQuery480) {
                paddingLeft = '10px'; // åŒ¹é… CSS: padding: 8px 30px 8px 10px
                logoTextGap = '6px'; // ç§»åŠ¨ç«¯å‡å°é—´è·
                logoSize = '18px'; // ç§»åŠ¨ç«¯å‡å°logo
                emojiSize = '12px'; // ç§»åŠ¨ç«¯å‡å°emoji
            } else if (isMediaQuery768) {
                paddingLeft = '12px'; // åŒ¹é… CSS: padding: 10px 35px 10px 12px
                logoTextGap = '7px'; // ä¸­ç­‰å±å¹•å‡å°é—´è·
                logoSize = '19px'; // ä¸­ç­‰å±å¹•ç¨å¾®å‡å°logo
                emojiSize = '13px'; // ä¸­ç­‰å±å¹•ç¨å¾®å‡å°emoji
            }
            
            contentDiv.style.cssText = `
                display: flex;
                align-items: center;
                padding-left: ${paddingLeft};
                height: 100%;
                gap: ${logoTextGap};
            `;
            
            // åˆ›å»ºLogoå…ƒç´ 
            let logoElement;
            if (logoType === 'emoji') {
                logoElement = document.createElement('div');
                logoElement.textContent = logoUrl; // logoUrlå®é™…ä¸Šæ˜¯emojiå­—ç¬¦
                logoElement.style.cssText = `
                    width: ${logoSize};
                    height: ${logoSize};
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                    font-size: ${emojiSize};
                    background: rgba(0,0,0,0.1);
                `;
            } else {
                logoElement = document.createElement('img');
                logoElement.src = logoUrl;
                logoElement.style.cssText = `
                    width: ${logoSize};
                    height: ${logoSize};
                    border-radius: 50%;
                    object-fit: cover;
                    flex-shrink: 0;
                `;
                
                // å¤„ç†å›¾ç‰‡åŠ è½½å¤±è´¥
                logoElement.onerror = function() {
                    logoElement.style.display = 'none';
                    textSpan.textContent = displayText;
                };
            }
            
            // åˆ›å»ºæ–‡æœ¬å…ƒç´ 
            const textSpan = document.createElement('span');
            textSpan.textContent = displayText;
            textSpan.style.cssText = `
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            `;
            
            contentDiv.appendChild(logoElement);
            contentDiv.appendChild(textSpan);
            displayOverlay.appendChild(contentDiv);
            selectElement.style.color = 'transparent';
        }
        
        // æ¢å¤åŸå§‹æ˜¾ç¤º
        function restoreOriginalDisplay(selectElement) {
            selectElement.style.color = '';
            const displayOverlay = selectElement.nextElementSibling;
            if (displayOverlay && displayOverlay.classList.contains('custom-select-display')) {
                displayOverlay.style.display = 'none';
            }
        }

        // åŸºç¡€æ¢ç®—åŠŸèƒ½äº‹ä»¶ç›‘å¬å™¨
        function setupBasicEventListeners() {
            for (let i = 1; i <= 6; i++) {
                // é‡‘é¢è¾“å…¥äº‹ä»¶
                document.getElementById(`amount${i}`).addEventListener('input', () => {
                    console.log('Input event triggered for amount' + i);
                    lastInputField = i;
                    convert(i);
                    saveState();
                });
                
                // è´§å¸é€‰æ‹©äº‹ä»¶
                document.getElementById(`currency${i}`).addEventListener('change', function() {
                    console.log('Currency change event triggered for currency' + i);
                    
                    // å¤„ç†è‡ªå®šä¹‰ä»£å¸é€‰æ‹©
                    if (this.value === 'CUSTOM') {
                        currentSelectId = this.id;
                        openCustomTokenModal();
                        return;
                    }
                    
                    // è®°ä½ä¹‹å‰çš„é€‰æ‹©
                    this.setAttribute('data-previous-value', this.value);
                    
                    // æ›´æ–°å¤–éƒ¨æ˜¾ç¤º
                    updateSelectDisplay(this);
                    
                    // è´§å¸é€‰æ‹©å˜æ›´æ—¶ï¼Œä»¥æœ€åè¾“å…¥çš„æ ä½ä¸ºåŸºå‡†é‡æ–°è®¡ç®—
                    convert(lastInputField);
                    saveState();
                });
                
                // å¤„ç†é‡æ–°é€‰æ‹©è‡ªå®šä¹‰ä»£å¸çš„ç‰¹æ®Šæƒ…å†µ
                document.getElementById(`currency${i}`).addEventListener('focus', function() {
                    // å½“è·å¾—ç„¦ç‚¹æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯CUSTOMï¼Œä¸´æ—¶æ”¹ä¸ºä¸€ä¸ªç‰¹æ®Šå€¼
                    if (this.value === 'CUSTOM') {
                        this.setAttribute('data-was-custom', 'true');
                        // ä¸´æ—¶è®¾ä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„å€¼ï¼Œè¿™æ ·å†é€‰CUSTOMæ—¶ä¼šè§¦å‘change
                        this.value = 'TEMP_CUSTOM_PLACEHOLDER';
                    }
                });
                
                document.getElementById(`currency${i}`).addEventListener('blur', function() {
                    // å¤±å»ç„¦ç‚¹æ—¶ï¼Œå¦‚æœè¿˜æ˜¯ä¸´æ—¶å€¼ï¼Œæ¢å¤ä¸ºCUSTOM
                    if (this.value === 'TEMP_CUSTOM_PLACEHOLDER' && this.getAttribute('data-was-custom') === 'true') {
                        this.value = 'CUSTOM';
                    }
                    this.removeAttribute('data-was-custom');
                });
                
                // å¤„ç†é‡æ–°é€‰æ‹©è‡ªå®šä¹‰ä»£å¸çš„æƒ…å†µ
                // åªåœ¨changeäº‹ä»¶ä¸­å¤„ç†ï¼Œä¸ä½¿ç”¨å…¶ä»–äº‹ä»¶
                // è¿™æ ·é¿å…äº†ä¸‹æ‹‰èœå•æ‰“å¼€æ—¶å°±è§¦å‘å¼¹çª—çš„é—®é¢˜
            }
        }
        
        // è‡ªå®šä¹‰ä»£å¸åŠŸèƒ½
        let currentSelectId = null;
        let customTokens = new Map(); // å­˜å‚¨è‡ªå®šä¹‰ä»£å¸æ•°æ®
        
        // åŸºäºå¸‚å€¼æ’åä¼°ç®—ä»·æ ¼çš„å‡½æ•°
        function getEstimatedPrice(coin) {
            // å¦‚æœæ²¡æœ‰å¸‚å€¼æ’åï¼Œç»™ä¸€ä¸ªé»˜è®¤çš„å°ä»·æ ¼
            if (!coin.market_cap_rank) {
                return 0.001; // é»˜è®¤ $0.001
            }
            
            const rank = coin.market_cap_rank;
            
            // åŸºäºå¸‚å€¼æ’åçš„ç²—ç•¥ä»·æ ¼ä¼°ç®—
            if (rank <= 10) return 50; // å‰10åï¼Œå¤§æ¦‚$50
            if (rank <= 50) return 5; // å‰50åï¼Œå¤§æ¦‚$5
            if (rank <= 100) return 1; // å‰100åï¼Œå¤§æ¦‚$1
            if (rank <= 500) return 0.1; // å‰500åï¼Œå¤§æ¦‚$0.1
            if (rank <= 1000) return 0.01; // å‰1000åï¼Œå¤§æ¦‚$0.01
            return 0.001; // å…¶ä»–ï¼Œå¤§æ¦‚$0.001
        }
        
        // æœ¬åœ°å¸¸è§ä»£å¸æ•°æ®åº“
        function getLocalTokenResults(query) {
            const commonTokens = [
                { id: 'dogecoin', name: 'Dogecoin', symbol: 'doge', large: 'https://assets.coingecko.com/coins/images/5/large/dogecoin.png', market_cap_rank: 8 },
                { id: 'cardano', name: 'Cardano', symbol: 'ada', large: 'https://assets.coingecko.com/coins/images/975/large/cardano.png', market_cap_rank: 9 },
                { id: 'polkadot', name: 'Polkadot', symbol: 'dot', large: 'https://assets.coingecko.com/coins/images/12171/large/polkadot.png', market_cap_rank: 12 },
                { id: 'chainlink', name: 'Chainlink', symbol: 'link', large: 'https://assets.coingecko.com/coins/images/877/large/chainlink-new-logo.png', market_cap_rank: 15 },
                { id: 'polygon', name: 'Polygon', symbol: 'matic', large: 'https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png', market_cap_rank: 16 },
                { id: 'avalanche-2', name: 'Avalanche', symbol: 'avax', large: 'https://assets.coingecko.com/coins/images/12559/large/coin-round-red.png', market_cap_rank: 17 },
                { id: 'shiba-inu', name: 'Shiba Inu', symbol: 'shib', large: 'https://assets.coingecko.com/coins/images/11939/large/shiba.png', market_cap_rank: 18 },
                { id: 'uniswap', name: 'Uniswap', symbol: 'uni', large: 'https://assets.coingecko.com/coins/images/12504/large/uniswap-uni.png', market_cap_rank: 20 },
                { id: 'litecoin', name: 'Litecoin', symbol: 'ltc', large: 'https://assets.coingecko.com/coins/images/2/large/litecoin.png', market_cap_rank: 21 },
                { id: 'near', name: 'NEAR Protocol', symbol: 'near', large: 'https://assets.coingecko.com/coins/images/10365/large/near_icon.png', market_cap_rank: 25 },
                { id: 'aptos', name: 'Aptos', symbol: 'apt', large: 'https://assets.coingecko.com/coins/images/26455/large/aptos_round.png', market_cap_rank: 30 },
                { id: 'arbitrum', name: 'Arbitrum', symbol: 'arb', large: 'https://assets.coingecko.com/coins/images/16547/large/photo_2023-03-29_21.47.00.jpeg', market_cap_rank: 35 },
                { id: 'optimism', name: 'Optimism', symbol: 'op', large: 'https://assets.coingecko.com/coins/images/25244/large/Optimism.png', market_cap_rank: 40 }
            ];
            
            const lowerQuery = query.toLowerCase();
            return commonTokens.filter(token => 
                token.name.toLowerCase().includes(lowerQuery) || 
                token.symbol.toLowerCase().includes(lowerQuery)
            );
        }
        
        // è‡ªå®šä¹‰ä»£å¸çš„äº‹ä»¶ç›‘å¬å·²åˆå¹¶åˆ°ä¸Šé¢çš„currency changeäº‹ä»¶ä¸­
        
        // æ‰“å¼€è‡ªå®šä¹‰ä»£å¸å¼¹çª—
        function openCustomTokenModal() {
            document.getElementById('customTokenModal').style.display = 'block';
            document.getElementById('tokenSearchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
            setupSearchInputListener(); // è®¾ç½®å›è½¦é”®ç›‘å¬
            
            // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
            setTimeout(() => {
                const searchInput = document.getElementById('tokenSearchInput');
                if (searchInput) {
                    searchInput.focus();
                }
            }, 100); // çŸ­æš‚å»¶è¿Ÿç¡®ä¿å¼¹çª—å®Œå…¨æ˜¾ç¤ºåå†èšç„¦
        }
        
        // å…³é—­è‡ªå®šä¹‰ä»£å¸å¼¹çª—
        function closeCustomTokenModal() {
            document.getElementById('customTokenModal').style.display = 'none';
            
            // å¦‚æœç”¨æˆ·æ²¡æœ‰é€‰æ‹©æ–°ä»£å¸å°±å…³é—­å¼¹çª—ï¼Œä¿æŒå½“å‰çŠ¶æ€
            if (currentSelectId) {
                const currentSelect = document.getElementById(currentSelectId);
                if (currentSelect && currentSelect.value === 'CUSTOM') {
                    const customOption = currentSelect.querySelector('option[value="CUSTOM"]');
                    const hasToken = customOption && customOption.getAttribute('data-token-key');
                    
                    if (!hasToken) {
                        // ç¬¬ä¸€æ¬¡ä½¿ç”¨è‡ªå®šä¹‰ä»£å¸ä½†æ²¡æœ‰é€‰æ‹©ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„é€‰æ‹©
                        const previousValue = currentSelect.getAttribute('data-previous-value');
                        if (previousValue && previousValue !== 'CUSTOM') {
                            currentSelect.value = previousValue;
                        } else {
                            currentSelect.value = 'BTC';
                        }
                    }
                    // å¦‚æœå·²ç»æœ‰ä»£å¸ï¼Œä¿æŒCUSTOMé€‰æ‹©ä¸å˜
                }
            }
            
            currentSelectId = null;
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('customTokenModal');
            if (event.target === modal) {
                closeCustomTokenModal();
            }
        });
        
        // æœç´¢ä»£å¸
        async function searchTokens() {
            const query = document.getElementById('tokenSearchInput').value.trim();
            if (!query) {
                return;
            }
            
            const loadingIndicator = document.getElementById('loadingIndicator');
            const searchResults = document.getElementById('searchResults');
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            loadingIndicator.style.display = 'block';
            searchResults.innerHTML = '';
            
            try {
                // ä½¿ç”¨CoinGecko APIæœç´¢ä»£å¸
                let searchUrl = `https://api.coingecko.com/api/v3/search?query=${encodeURIComponent(query)}`;
                console.log('æœç´¢URL:', searchUrl);
                
                let response;
                try {
                    response = await fetch(searchUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                } catch (corsError) {
                    console.log('æœç´¢APIç›´æ¥è®¿é—®å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®åº“:', corsError);
                    // ä½¿ç”¨æœ¬åœ°çš„å¸¸è§ä»£å¸æ•°æ®åº“ä½œä¸ºå¤‡ç”¨
                    const localResults = getLocalTokenResults(query);
                    response = {
                        ok: true,
                        json: async () => ({ coins: localResults })
                    };
                }
                
                if (!response.ok) {
                    throw new Error('æœç´¢è¯·æ±‚å¤±è´¥');
                }
                
                const data = await response.json();
                loadingIndicator.style.display = 'none';
                
                displaySearchResults(data.coins || []);
                
            } catch (error) {
                console.error('æœç´¢ä»£å¸æ—¶å‡ºé”™:', error);
                loadingIndicator.style.display = 'none';
                searchResults.innerHTML = '<div class="no-results">æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
            }
        }
        
        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(coins) {
            const searchResults = document.getElementById('searchResults');
            
            if (coins.length === 0) {
                searchResults.innerHTML = '<div class="no-results">æœªæ‰¾åˆ°ç›¸å…³ä»£å¸</div>';
                return;
            }
            
            searchResults.innerHTML = '';
            
            // é™åˆ¶æ˜¾ç¤ºå‰10ä¸ªç»“æœ
            coins.slice(0, 10).forEach(coin => {
                const tokenDiv = document.createElement('div');
                tokenDiv.className = 'token-result';
                tokenDiv.onclick = () => selectCustomToken(coin);
                
                tokenDiv.innerHTML = `
                    <img src="${coin.large || coin.thumb}" alt="${coin.name}" class="token-logo" onerror="this.style.display='none'">
                    <div class="token-content">
                        <div class="token-name-row">
                            <div class="token-name">${coin.name}</div>
                        </div>
                        <div class="token-bottom-row">
                            <div class="token-symbol">${coin.symbol}</div>
                            <div class="token-price">
                                å¸‚å€¼æ’å: ${coin.market_cap_rank || 'N/A'}
                            </div>
                        </div>
                    </div>
                `;
                
                searchResults.appendChild(tokenDiv);
            });
        }
        
        // é€‰æ‹©è‡ªå®šä¹‰ä»£å¸
        async function selectCustomToken(coin) {
            try {
                console.log('é€‰æ‹©çš„ä»£å¸:', coin);
                
                // è·å–ä»£å¸è¯¦ç»†ä¿¡æ¯å’Œä»·æ ¼
                // å°è¯•ç›´æ¥è®¿é—®ï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨CORSä»£ç†
                let priceUrl = `https://api.coingecko.com/api/v3/simple/price?ids=${coin.id}&vs_currencies=usd`;
                console.log('è¯·æ±‚ä»·æ ¼URL:', priceUrl);
                
                let response;
                try {
                    response = await fetch(priceUrl, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                } catch (corsError) {
                    console.log('ç›´æ¥è®¿é—®å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:', corsError);
                    // å¦‚æœç›´æ¥è®¿é—®å¤±è´¥ï¼Œä½¿ç”¨ä¸€ä¸ªå¤‡ç”¨çš„ä»·æ ¼ä¼°ç®—
                    // åŸºäºå¸‚å€¼æ’åæä¾›ä¸€ä¸ªå¤§æ¦‚çš„ä»·æ ¼
                    const estimatedPrice = getEstimatedPrice(coin);
                    console.log('ä½¿ç”¨ä¼°ç®—ä»·æ ¼:', estimatedPrice);
                    
                    // åˆ›å»ºæ¨¡æ‹Ÿå“åº”
                    response = {
                        ok: true,
                        json: async () => ({ [coin.id]: { usd: estimatedPrice } })
                    };
                    
                    // æç¤ºç”¨æˆ·æ­£åœ¨ä½¿ç”¨ä¼°ç®—ä»·æ ¼
                    console.log('âš ï¸ æ³¨æ„ï¼šæ­£åœ¨ä½¿ç”¨åŸºäºå¸‚å€¼æ’åçš„ä¼°ç®—ä»·æ ¼ï¼Œå¯èƒ½ä¸å¤Ÿå‡†ç¡®');
                }
                
                console.log('ä»·æ ¼APIå“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    console.error('ä»·æ ¼APIè¯·æ±‚å¤±è´¥:', response.status, response.statusText);
                    throw new Error(`è·å–ä»£å¸ä»·æ ¼å¤±è´¥: ${response.status} ${response.statusText}`);
                }
                
                const priceData = await response.json();
                console.log('ä»·æ ¼æ•°æ®:', priceData);
                
                const price = priceData[coin.id]?.usd || 0;
                console.log('è§£æå‡ºçš„ä»·æ ¼:', price);
                
                if (price === 0) {
                    console.warn('ä»·æ ¼ä¸º0ï¼Œå¯èƒ½æ•°æ®æœ‰è¯¯');
                }
                
                // å­˜å‚¨è‡ªå®šä¹‰ä»£å¸ä¿¡æ¯
                const tokenKey = coin.symbol.toUpperCase();
                const logoUrl = coin.large || coin.thumb || coin.image;
                customTokens.set(tokenKey, {
                    id: coin.id,
                    name: coin.name,
                    symbol: coin.symbol,
                    image: logoUrl,
                    price: price,
                    isEstimated: price === getEstimatedPrice(coin) // æ ‡è®°æ˜¯å¦ä¸ºä¼°ç®—ä»·æ ¼
                });
                
                // ä¸æ·»åŠ åˆ°ä¸‹æ‹‰èœå•ï¼Œåªåœ¨å½“å‰ä¼šè¯ä¸­ä½¿ç”¨
                
                // è®¾ç½®è§¦å‘æœç´¢çš„ä¸‹æ‹‰èœå•ä½¿ç”¨è‡ªå®šä¹‰ä»£å¸
                if (currentSelectId) {
                    const currentSelect = document.getElementById(currentSelectId);
                    if (currentSelect) {
                        // ä¿æŒCUSTOMé€‰é¡¹çš„åŸå§‹æ–‡æœ¬"ğŸ” è‡ªå®šä¹‰ä»£å¸"ï¼Œä½†å­˜å‚¨ä»£å¸ä¿¡æ¯
                        const customOption = currentSelect.querySelector('option[value="CUSTOM"]');
                        if (customOption) {
                            // æ›´æ–°ä»£å¸ä¿¡æ¯ï¼ˆè¦†ç›–ä¹‹å‰çš„é€‰æ‹©ï¼‰
                            customOption.setAttribute('data-token-key', tokenKey);
                            customOption.setAttribute('data-token-name', coin.name);
                            customOption.setAttribute('data-token-symbol', coin.symbol.toUpperCase());
                            customOption.setAttribute('data-token-logo', logoUrl);
                            
                            // è®¾ç½®å¤–éƒ¨æ˜¾ç¤ºçš„æ–‡æœ¬ï¼ˆåªæ˜¾ç¤ºä»£å¸ç¬¦å·ï¼ŒLogoå°†é€šè¿‡CSSæ˜¾ç¤ºï¼‰
                            customOption.setAttribute('data-display-text', coin.symbol.toUpperCase());
                        }
                        currentSelect.value = 'CUSTOM';
                        
                        // è®°ä½è¿™ä¸ªé€‰æ‹©ä½œä¸º"ä¹‹å‰çš„å€¼"
                        currentSelect.setAttribute('data-previous-value', 'CUSTOM');
                        
                        // ç«‹å³æ›´æ–°å¤–éƒ¨æ˜¾ç¤º
                        updateSelectDisplay(currentSelect);
                    }
                }
                
                // é‡æ–°åŠ è½½æ±‡ç‡ä»¥åŒ…å«æ–°çš„è‡ªå®šä¹‰ä»£å¸
                await loadRates();
                
                // å…³é—­å¼¹çª—
                closeCustomTokenModal();
                
                // é‡æ–°è®¡ç®—è½¬æ¢
                if (currentSelectId) {
                    const selectIndex = parseInt(currentSelectId.replace('currency', ''));
                    convert(selectIndex);
                    saveState();
                }
                
            } catch (error) {
                console.error('é€‰æ‹©ä»£å¸æ—¶å‡ºé”™:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                
                // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                let errorMessage = 'è·å–ä»£å¸ä¿¡æ¯å¤±è´¥';
                if (apiStatus.rateLimited || error.message.includes('429')) {
                    errorMessage = 'APIè°ƒç”¨å·²è¾¾é™åˆ¶ï¼Œè¯·ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•';
                } else if (!apiStatus.coingecko) {
                    errorMessage = 'å·²è¶…è¿‡æ±‡ç‡æœåŠ¡ API è®¿é—®é™åˆ¶æ¬¡æ•°ï¼Œè‡ªå®šä¹‰ä»£å¸åŠŸèƒ½æš‚æ—¶æ— æ³•ä½¿ç”¨';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMessage += 'ï¼šç½‘ç»œè¿æ¥é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•';
                } else if (error.message.includes('403') || error.message.includes('401')) {
                    errorMessage += 'ï¼šAPIè®¿é—®å—é™';
                } else {
                    errorMessage += `ï¼š${error.message}`;
                }
                
                alert(errorMessage);
            }
        }
        
        // æœç´¢é˜²æŠ–
        let searchTimeout;
        
        // è‡ªåŠ¨æœç´¢ç›‘å¬å™¨ - åœ¨å¼¹çª—æ‰“å¼€æ—¶è®¾ç½®
        function setupSearchInputListener() {
            const input = document.getElementById('tokenSearchInput');
            if (input && !input.hasSearchListener) {
                input.addEventListener('input', function(e) {
                    const query = e.target.value.trim();
                    
                    // æ¸…é™¤ä¹‹å‰çš„æœç´¢å®šæ—¶å™¨
                    if (searchTimeout) {
                        clearTimeout(searchTimeout);
                    }
                    
                    if (query === '') {
                        // å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œæ¸…ç©ºç»“æœ
                        document.getElementById('searchResults').innerHTML = '';
                        document.getElementById('loadingIndicator').style.display = 'none';
                        return;
                    }
                    
                    // è®¾ç½®é˜²æŠ–å»¶è¿Ÿï¼šè¾“å…¥åœæ­¢300æ¯«ç§’åå¼€å§‹æœç´¢
                    searchTimeout = setTimeout(() => {
                        searchTokens();
                    }, 300);
                });
                
                // ä¿ç•™å›è½¦é”®æœç´¢
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        if (searchTimeout) {
                            clearTimeout(searchTimeout);
                        }
                        searchTokens();
                    }
                });
                
                input.hasSearchListener = true;
            }
        }
        
    </script>
    </div>

    <!-- è‡ªå®šä¹‰ä»£å¸å¼¹çª— -->
    <div id="customTokenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è‡ªå®šä¹‰ä»£å¸æœç´¢</h3>
                <span class="close" onclick="closeCustomTokenModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="search-container">
                    <input type="text" id="tokenSearchInput" placeholder="è¾“å…¥ä»£å¸åç§°æˆ–ç¬¦å· (å¦‚: Bitcoin, BTC)" />
                </div>
                <div id="searchResults" class="search-results"></div>
                <div id="loadingIndicator" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨æœç´¢ä»£å¸...</p>
                </div>
            </div>
        </div>
    </div>

</body>
</html>